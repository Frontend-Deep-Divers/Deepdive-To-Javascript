# 45ì¥ í”„ë¡œë¯¸ìŠ¤

ë¹„ë™ê¸° ì²˜ë¦¬ì˜ ì „í†µì ì¸ ë°©ì‹ì¸ ì½œë°± íŒ¨í„´ì€ ì½œë°± í—¬ë¡œ ì¸í•´ ê°€ë…ì„±ì´ ì¢‹ì§€ ì•Šê³  ë¹„ë™ê¸° ì²˜ë¦¬ ì¤‘ ë°œìƒí•˜ëŠ” ì—ëŸ¬ì˜ ì²˜ë¦¬ê°€ ì–´ë ¤ìš°ë©° ì—¬ëŸ¬ ê°œì˜ ë¹„ë™ê¸° ì²˜ë¦¬ë¥´ í•œ ë²ˆì— ì²˜ë¦¬í•˜ëŠ” ë°ë„ í•œê³„ê°€ ìˆë‹¤.

ES6ì—ì„œ ë¹„ë™ê¸° ì²˜ë¦¬ë¥¼ ìœ„í•œ ë˜ ë‹¤ë¥¸ íŒ¨í„´ìœ¼ë¡œ í”„ë¡œë¯¸ìŠ¤(Promise)ê°€ ë„ì…ë˜ì—ˆë‹¤. **ì „í†µì ì¸ ì½œë°± íŒ¨í„´ì´ ê°€ì§„ ë‹¨ì ì„ ë³´ì™„í•˜ê³  ë¹„ë™ê¸° ì²˜ë¦¬ ì‹œì ì„ ëª…í™•í•˜ê²Œ í‘œí˜„í•  ìˆ˜ ìˆëŠ” ì¥ì ì´ ìˆë‹¤**.

## 45.1 ë¹„ë™ê¸° ì²˜ë¦¬ë¥¼ ìœ„í•œ ì½œë°± íŒ¨í„´ì˜ ë‹¨ì 

### ì½œë°± í—¬

ë¹„ë™ê¸° í•¨ìˆ˜ëŠ” í•¨ìˆ˜ ë‚´ë¶€ì— ë¹„ë™ê¸°ë¡œ ë™ì‘í•˜ëŠ” ì½”ë“œë¥¼ í¬í•¨í•œ í•¨ìˆ˜ë¥¼ ë§í•œë‹¤.

ë¹„ë™ê¸° í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ë©´ í•¨ìˆ˜ ë‚´ë¶€ì˜ ë¹„ë™ê¸°ë¡œ ë™ì‘í•˜ëŠ” ì½”ë“œê°€ ì™„ë£Œë˜ì§€ ì•Šë”ë¼ë„ ì¦‰ì‹œ ì¢…ë£Œëœë‹¤. ë”°ë¼ì„œ ë¹„ë™ê¸° í•¨ìˆ˜ ë‚´ë¶€ì˜ ë¹„ë™ê¸°ë¡œ ë™ì‘í•˜ëŠ” ì½”ë“œì—ì„œ ì²˜ë¦¬ ê²°ê³¼ë¥¼ ì™¸ë¶€ë¡œ ë°˜í™˜í•˜ê±°ë‚˜ ìƒìœ„ ìŠ¤ì½”í”„ì— ë³€ìˆ˜ì— í• ë‹¹í•˜ë©´ ê¸°ëŒ€í•œ ëŒ€ë¡œ ë™ì‘í•˜ì§€ ì•ŠëŠ”ë‹¤.

```js
let g = 0;

// ë¹„ë™ê¸° í•¨ìˆ˜ì¸ setTimeout í•¨ìˆ˜ëŠ” ì½œë°± í•¨ìˆ˜ì˜ ì²˜ë¦¬ ê²°ê³¼ë¥¼ ì™¸ë¶€ë¡œ ë°˜í™˜í•˜ê±°ë‚˜
// ìƒìœ„ ìŠ¤ì½”í”„ì˜ ë³€ìˆ˜ì— í• ë‹¹í•˜ì§€ ëª»í•œë‹¤.
setTimeout(() => {
  g = 100;
}, 0);
console.log(g); // 0
```

ê·¸ëŸ¬ë¯€ë¡œ ë‚´ë¶€ì˜ ë¹„ë™ê¸°ë¡œ ë™ì‘í•˜ëŠ” ì½”ë“œì˜ ì²˜ë¦¬ ê²°ê³¼(ì„œë²„ì˜ ì‘ë‹µ ë“±)ì— ëŒ€í•œ í›„ì† ì²˜ë¦¬ëŠ” ë¹„ë™ê¸° í•¨ìˆ˜ ë‚´ë¶€ì—ì„œ ìˆ˜í–‰í•´ì•¼ í•œë‹¤. ì´ë•Œ ë¹„ë™ê¸° í•¨ìˆ˜ì— ì½œë°± í•¨ìˆ˜ë¥¼ ì „ë‹¬í•˜ì—¬ ì½œë°± í•¨ìˆ˜ê°€ ì´ë¥¼ ì²˜ë¦¬í•˜ê²Œ í•˜ëŠ” ê²ƒì´ ì¼ë°˜ì ì´ë‹¤.

í•„ìš”ì— ë”°ë¼ ë¹„ë™ê¸° ì²˜ë¦¬ê°€ ì„±ê³µí•˜ë©´ í˜¸ì¶œë  ì½œë°± í•¨ìˆ˜ì™€ ì‹¤íŒ¨í•˜ë©´ í˜¸ì¶œë  ì½œë°± í•¨ìˆ˜ë¥¼ ì „ë‹¬í•œë‹¤.

```js
// GET ìš”ì²­ì„ ìœ„í•œ ë¹„ë™ê¸° í•¨ìˆ˜
const get = (url, successCallback, failureCallback) => {
  const xhr = new XMLHttpRequest();
  xhr.open("GET", url);
  xhr.send();

  xhr.onload = () => {
    if (xhr.status === 200) {
      // ì„œë²„ì˜ ì‘ë‹µì„ ì½œë°± í•¨ìˆ˜ì— ì¸ìˆ˜ë¡œ ì „ë‹¬í•˜ë©´ì„œ í˜¸ì¶œí•˜ì—¬ ì‘ë‹µì— ëŒ€í•œ í›„ì† ì²˜ë¦¬ë¥¼ í•œë‹¤.
      successCallback(JSON.parse(xhr.response));
    } else {
      // ì—ëŸ¬ ì •ë³´ë¥¼ ì½œë°± í•¨ìˆ˜ì— ì¸ìˆ˜ë¡œ ì „ë‹¬í•˜ë©´ì„œ í˜¸ì¶œí•˜ì—¬ ì—ëŸ¬ ì²˜ë¦¬ë¥¼ í•œë‹¤.
      failureCallback(xhr.status);
    }
  };
};

// idê°€ 1ì¸ postë¥¼ ì·¨ë“
// ì„œë²„ì˜ ì‘ë‹µì— ëŒ€í•œ í›„ì† ì²˜ë¦¬ë¥¼ ìœ„í•œ ì½œë°± í•¨ìˆ˜ë¥¼ ë¹„ë™ê¸° í•¨ìˆ˜ì¸ getì— ì „ë‹¬í•´ì•¼ í•œë‹¤.
get("https://jsonplaceholder.typicode.com/posts/1", console.log, console.error);
/*
{
  "userId": 1,
  "id": 1,
  "title": "sunt aut facere ...",
  "body": "quia et suscipit ..."
}
*/
```

ì´ì²˜ëŸ¼ **ì½œë°± í•¨ìˆ˜ë¥¼ í†µí•´ ë¹„ë™ê¸° ì²˜ë¦¬ ê²°ê³¼ì— ëŒ€í•œ í›„ì† ì²˜ë¦¬ë¥¼ ìˆ˜í–‰í•˜ëŠ” ë¹„ë™ê¸° í•¨ìˆ˜ê°€ ë¹„ë™ê¸° ì²˜ë¦¬ ê²°ê³¼ë¥¼ ê°€ì§€ê³  ë˜ë‹¤ì‹œ ë¹„ë™ê¸° í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•´ì•¼ í•œë‹¤ë©´ ì½œë°± í•¨ìˆ˜ í˜¸ì¶œì´ ì¤‘ì²©ë˜ì–´ ë³µì¡ë„ê°€ ë†’ì•„ì§€ëŠ” í˜„ìƒì´ ë°œìƒ**í•˜ëŠ”ë°, ì´ë¥¼ ì½œë°± í—¬ì´ë¼ í•œë‹¤.

ë‹¤ìŒì€ ì½œë°± í—¬ì´ ë°œìƒí•˜ëŠ” ì „í˜•ì ì¸ ì‚¬ë¡€ë‹¤. ê° ë‹¨ê³„ì—ì„œ ë°œìƒí•œ ë¹„ë™ê¸° ì²˜ë¦¬ ê²°ê³¼ë¥¼ ê°€ì§€ê³  ì—°ì†ìœ¼ë¡œ ë¹„ë™ê¸° í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ê³  ìˆë‹¤.

```js
get("/step1", (a) => {
  get(`/step2/${a}`, (b) => {
    get(`/step3/${b}`, (c) => {
      get(`/step4/${c}`, (d) => {
        console.log(d);
      });
    });
  });
});
```

### ì—ëŸ¬ ì²˜ë¦¬ì˜ í•œê³„

ì½œë°± íŒ¨í„´ì˜ ë¬¸ì œì  ì¤‘ ê°€ì¥ ì‹¬ê°í•œ ê²ƒì€ ì—ëŸ¬ ì²˜ë¦¬ê°€ ê³¤ë€í•˜ë‹¤ëŠ” ê²ƒì´ë‹¤.

```js
try {
  setTimeout(() => {
    throw new Error("Error!");
  }, 1000);
} catch (e) {
  // ì—ëŸ¬ë¥¼ ìºì¹˜í•˜ì§€ ëª»í•œë‹¤
  console.error("ìºì¹˜í•œ ì—ëŸ¬", e);
}
```

ì—ëŸ¬ëŠ” í˜¸ì¶œì(caller) ë°©í–¥(ì‹¤í–‰ ì¤‘ì¸ ì‹¤í–‰ ì»¨í…ìŠ¤íŠ¸ê°€ í‘¸ì‹œë˜ê¸° ì§ì „ì— í‘¸ì‹œëœ ì‹¤í–‰ ì»¨í…ìŠ¤íŠ¸ ë°©í–¥)ìœ¼ë¡œ ì „íŒŒëœë‹¤. í•˜ì§€ë§Œ ì½œë°± í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•œ ê±´ `setTimeout` í•¨ìˆ˜ê°€ ì•„ë‹ˆë¯€ë¡œ `setTimeout` í•¨ìˆ˜ì˜ ì½œë°± í•¨ìˆ˜ê°€ ë°œìƒì‹œí‚¨ ì—ëŸ¬ëŠ” `catch` ë¸”ë¡ì—ì„œ ìºì¹˜ë˜ì§€ ì•ŠëŠ”ë‹¤.

## 45.2 í”„ë¡œë¯¸ìŠ¤ì˜ ìƒì„±

í”„ë¡œë¯¸ìŠ¤ëŠ” **ë¹„ë™ê¸° ì²˜ë¦¬ ìƒíƒœì™€ ì²˜ë¦¬ ê²°ê³¼ë¥¼ ê´€ë¦¬í•˜ëŠ” ê°ì²´**ë‹¤.

`Promise` ìƒì„±ì í•¨ìˆ˜ë¥¼ `new` ì—°ì‚°ìì™€ í•¨ê»˜ í˜¸ì¶œí•˜ë©´ í”„ë¡œë¯¸ìŠ¤(`Promise` ê°ì²´)ë¥¼ ìƒì„±í•œë‹¤. `Promise`ëŠ” ES ì‚¬ì–‘ì— ì •ì˜ëœ í‘œì¤€ ë¹ŒíŠ¸ì¸ ê°ì²´ë‹¤.

`Promise` ìƒì„±ì í•¨ìˆ˜ëŠ” ë¹„ë™ê¸° ì²˜ë¦¬ë¥¼ ìˆ˜í–‰í•  ì½œë°± í•¨ìˆ˜ë¥¼ ì¸ìˆ˜ë¡œ ì „ë‹¬ë°›ëŠ”ë°, ì´ ì½œë°± í•¨ìˆ˜ëŠ” `resolve`ì™€ `reject` í•¨ìˆ˜ë¥¼ ì¸ìˆ˜ë¡œ ì „ë‹¬ë°›ëŠ”ë‹¤.

```js
// í”„ë¡œë¯¸ìŠ¤ ìƒì„±
const promise = new Promise((resolve, reject) => {
  // Promise í•¨ìˆ˜ì˜ ì½œë°± í•¨ìˆ˜ ë‚´ë¶€ì—ì„œ ë¹„ë™ê¸° ì²˜ë¦¬ë¥¼ ìˆ˜í–‰í•œë‹¤.
  if (/* ë¹„ë™ê¸° ì²˜ë¦¬ ì„±ê³µ */) {
    resolve('result');
  } else { /* ë¹„ë™ê¸° ì²˜ë¦¬ ì‹¤íŒ¨ */
    reject('failure reason');
  }
});
```

ì „ë‹¬ë°›ì€ ì½œë°± í•¨ìˆ˜ ë‚´ë¶€ì—ì„œ ë¹„ë™ê¸° ì²˜ë¦¬ë¥¼ ìˆ˜í–‰í•˜ë©°, ë¹„ë™ê¸° ì²˜ë¦¬ê°€ ì„±ê³µí•˜ë©´ `resolve` í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ê³ , ì‹¤íŒ¨í•˜ë©´ `reject` í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•œë‹¤.

ì•ì„œ ë³¸ `get` í•¨ìˆ˜ëŠ” `Promise`ë¥¼ ì‚¬ìš©í•˜ì—¬ ì•„ë˜ì™€ ê°™ì´ êµ¬í˜„í•  ìˆ˜ ìˆë‹¤.

```js
// GET ìš”ì²­ì„ ìœ„í•œ ë¹„ë™ê¸° í•¨ìˆ˜
const promiseGet = (url) => {
  return new Promise((resolve, reject) => {
    const xhr = new XMLHttpRequest();
    xhr.open("GET", url);
    xhr.send();

    xhr.onload = () => {
      if (xhr.status === 200) {
        // ì„±ê³µì ìœ¼ë¡œ ì‘ë‹µì„ ì „ë‹¬ë°›ìœ¼ë©´ resolve í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•œë‹¤.
        resolve(JSON.parse(xhr.response));
      } else {
        // ì—ëŸ¬ ì²˜ë¦¬ë¥¼ ìœ„í•´ reject í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•œë‹¤.
        reject(new Error(xhr.status));
      }
    };
  });
};

// promiseGet í•¨ìˆ˜ëŠ” í”„ë¡œë¯¸ìŠ¤ë¥¼ ë°˜í™˜í•œë‹¤.
promiseGet("https://jsonplaceholder.typicode.com/posts/1");
```

í”„ë¡œë¯¸ìŠ¤ëŠ” ë¹„ë™ê¸° ì²˜ë¦¬ ìƒíƒœì— ëŒ€í•œ ìƒíƒœ ì •ë³´ë¥¼ ê°–ëŠ”ë‹¤.

| í”„ë¡œë¯¸ìŠ¤ì˜ ìƒíƒœ ì •ë³´ | ì˜ë¯¸                                  | ìƒíƒœ ë³€ê²½ ì¡°ê±´                   |
| -------------------- | ------------------------------------- | -------------------------------- |
| `pending`            | ë¹„ë™ê¸° ì²˜ë¦¬ê°€ ì•„ì§ ìˆ˜í–‰ë˜ì§€ ì•Šì€ ìƒíƒœ | í”„ë¡œë¯¸ìŠ¤ê°€ ìƒì„±ëœ ì§í›„ ê¸°ë³¸ ìƒíƒœ |
| `fulfilled`          | ë¹„ë™ê¸° ì²˜ë¦¬ê°€ ìˆ˜í–‰ëœ ìƒíƒœ(ì„±ê³µ)       | `resolve` í•¨ìˆ˜ í˜¸ì¶œ              |
| `rejected`           | ë¹„ë™ê¸° ì²˜ë¦¬ê°€ ìˆ˜í–‰ëœ ìƒíƒœ(ì‹¤íŒ¨)       | `reject` í•¨ìˆ˜ í˜¸ì¶œ               |

ìƒì„±ëœ ì§í›„ì—ëŠ” `pending` ìƒíƒœë¥¼ ê°€ì§€ë©°, ì´í›„ ë¹„ë™ê¸° ì²˜ë¦¬ê°€ ìˆ˜í–‰ë˜ë©´ ë¹„ë™ê¸° ì²˜ë¦¬ ê²°ê³¼ì— ë”°ë¼ í”„ë¡œë¯¸ìŠ¤ì˜ ìƒíƒœê°€ ë³€ê²½ëœë‹¤.

- ë¹„ë™ê¸° ì²˜ë¦¬ ì„±ê³µ ì‹œ: `resolve` í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•´ í”„ë¡œë¯¸ìŠ¤ë¥¼ `fulfilled` ìƒíƒœë¡œ ë³€ê²½
- ë¹„ë™ê¸° ì²˜ë¦¬ ì‹¤íŒ¨ ì‹œ: `reject` í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•´ í”„ë¡œë¯¸ìŠ¤ë¥¼ `rejected` ìƒíƒœë¡œ ë³€ê²½

ì´ì²˜ëŸ¼ í”„ë¡œë¯¸ìŠ¤ì˜ ìƒíƒœëŠ” `resolve` ë˜ëŠ” `reject` í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ëŠ” ê²ƒìœ¼ë¡œ ê²°ì •ëœë‹¤.

`fulfilled`ì™€ `reject` ìƒíƒœë¥¼ ëª¨ë‘ `settled` ìƒíƒœë¼ê³  í•œë‹¤. `settled` ìƒíƒœëŠ” `pending` ìƒíƒœê°€ ì•„ë‹Œ ë¹„ë™ê¸° ì²˜ë¦¬ê°€ ìˆ˜í–‰ëœ ìƒíƒœë¥¼ ë§í•œë‹¤. `settled` ìƒíƒœê°€ ë˜ë©´ ë”ëŠ” ë‹¤ë¥¸ ìƒíƒœë¡œ ë³€í™”í•  ìˆ˜ ì—†ë‹¤.

í”„ë¡œë¯¸ìŠ¤ëŠ” ë¹„ë™ê¸° ì²˜ë¦¬ ê²°ê³¼(`result`)ë„ ìƒíƒœë¡œ ê°–ëŠ”ë‹¤. `fulfilled` ìƒíƒœì—ì„œëŠ” `value`ë¥¼, `rejected` ìƒíƒœì—ì„œëŠ” `error`ë¥¼ ê°–ëŠ”ë‹¤.

## 45.3 í”„ë¡œë¯¸ìŠ¤ì˜ í›„ì† ì²˜ë¦¬ ë©”ì„œë“œ

í”„ë¡œë¯¸ìŠ¤ì˜ ë¹„ë™ê¸° ì²˜ë¦¬ ìƒíƒœ ë³€í™”ì— ë”°ë¥¸ í›„ì† ì²˜ë¦¬ë¥¼ í•  ë•Œ, `then`, `catch`, `finally` ë©”ì„œë“œë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

í”„ë¡œë¯¸ìŠ¤ì˜ ë¹„ë™ê¸° ì²˜ë¦¬ ìƒíƒœê°€ ë³€í™”í•˜ë©´ í›„ì† ì²˜ë¦¬ ë©”ì„œë“œì— ì¸ìˆ˜ë¡œ ì „ë‹¬í•œ ì½œë°± í•¨ìˆ˜ê°€ ì„ íƒì ìœ¼ë¡œ í˜¸ì¶œëœë‹¤. ì´ë•Œ í›„ì† ì²˜ë¦¬ ë©”ì„œë“œì˜ ì½œë°± í•¨ìˆ˜ì— í”„ë¡œë¯¸ìŠ¤ì˜ ì²˜ë¦¬ ê²°ê³¼ê°€ ì¸ìˆ˜ë¡œ ì „ë‹¬ëœë‹¤.

ëª¨ë“  í›„ì† ì²˜ë¦¬ ë©”ì„œë“œëŠ” í”„ë¡œë¯¸ìŠ¤ë¥¼ ë°˜í™˜í•˜ë©°, ë¹„ë™ê¸°ë¡œ ë™ì‘í•œë‹¤.

### `Promise.prototype.then`

ë‘ ê°œì˜ ì½œë°± í•¨ìˆ˜ë¥¼ ì¸ìˆ˜ë¡œ ì „ë‹¬ë°›ëŠ”ë‹¤.

- ì²« ë²ˆì§¸ ì½œë°± í•¨ìˆ˜ëŠ” í”„ë¡œë¯¸ìŠ¤ê°€ `fulfilled` ìƒíƒœê°€ ë˜ë©´ í˜¸ì¶œëœë‹¤. ì´ë•Œ ì½œë°± í•¨ìˆ˜ëŠ” í”„ë¡œë¯¸ìŠ¤ì˜ ë¹„ë™ê¸° ì²˜ë¦¬ ê²°ê³¼ë¥¼ ì¸ìˆ˜ë¡œ ì „ë‹¬ë°›ëŠ”ë‹¤.
- ì²« ë²ˆì§¸ ì½œë°± í•¨ìˆ˜ëŠ” í”„ë¡œë¯¸ìŠ¤ê°€ `rejected` ìƒíƒœê°€ ë˜ë©´ í˜¸ì¶œëœë‹¤. ì´ë•Œ ì½œë°± í•¨ìˆ˜ëŠ” í”„ë¡œë¯¸ìŠ¤ì˜ ì—ëŸ¬ë¥¼ ì¸ìˆ˜ë¡œ ì „ë‹¬ë°›ëŠ”ë‹¤.

```js
// fulfilled
new Promise((resolve) => resolve("fulfilled")).then(
  (v) => console.log(v),
  (e) => console.error(e)
); // fulfilled

// rejected
new Promise((_, reject) => reject(new Error("rejected"))).then(
  (v) => console.log(v),
  (e) => console.error(e)
); // Error: rejected
```

`then` ë©”ì„œë“œì˜ ì½œë°± í•¨ìˆ˜ê°€ í”„ë¡œë¯¸ìŠ¤ë¥¼ ë°˜í™˜í•˜ë©´ ê·¸ í”„ë¡œë¯¸ìŠ¤ë¥¼ ê·¸ëŒ€ë¡œ ë°˜í™˜í•˜ê³ , ì½œë°± í•¨ìˆ˜ê°€ í”„ë¡œë¯¸ìŠ¤ê°€ ì•„ë‹Œ ê°’ì„ ë°˜í™˜í•˜ë©´ ê·¸ ê°’ì„ ì•”ë¬µì ìœ¼ë¡œ `resolve` ë˜ëŠ” `reject`í•˜ì—¬ í”„ë¡œë¯¸ìŠ¤ë¥¼ ìƒì„±í•´ ë°˜í™˜í•œë‹¤.

### `Promise.prototype.catch`

í•œ ê°œì˜ ì½œë°± í•¨ìˆ˜ë¥¼ ì¸ìˆ˜ë¡œ ì „ë‹¬ë°›ëŠ”ë‹¤. `catch` ë©”ì„œë“œì˜ ì½œë°± í•¨ìˆ˜ëŠ” í”„ë¡œë¯¸ìŠ¤ê°€ `rejected` ìƒíƒœì¸ ê²½ìš°ë§Œ í˜¸ì¶œëœë‹¤.

```js
// rejected
new Promise((_, reject) => reject(new Error("rejected"))).catch((e) =>
  console.log(e)
); // Error: rejected
```

`then(undeifned, onRejected)`ê³¼ ë™ì¼í•˜ê²Œ ë™ì‘í•œë‹¤. ì–¸ì œë‚˜ í”„ë¡œë¯¸ìŠ¤ë¥¼ ë°˜í™˜í•œë‹¤.

```js
// rejected
new Promise((_, reject) => reject(new Error("rejected"))).then(undefined, (e) =>
  console.log(e)
); // Error: rejected
```

### `Promise.prototype.finally`

í•œ ê°œì˜ ì½œë°± í•¨ìˆ˜ë¥¼ ì „ë‹¬ë°›ëŠ”ë‹¤. `finally` ë©”ì„œë“œì˜ ì½œë°± í•¨ìˆ˜ëŠ” í”„ë¡œë¯¸ìŠ¤ì˜ ìƒíƒœì— ê´€ê³„ì—†ì´ ë¬´ì¡°ê±´ í•œ ë²ˆ í˜¸ì¶œëœë‹¤.

```js
new Promise(() => {}).finally(() => console.log("finally")); // finally
```

í”„ë¡œë¯¸ìŠ¤ì˜ ìƒíƒœì™€ ìƒê´€ì—†ì´ ê³µí†µì ìœ¼ë¡œ ìˆ˜í–‰í•´ì•¼ í•  ì²˜ë¦¬ ë‚´ìš©ì´ ìˆì„ ë•Œ ìœ ìš©í•˜ë‹¤. `finally` ë©”ì„œë“œë„ `then/catch` ë©”ì„œë“œì™€ ë§ˆì°¬ê°€ì§€ë¡œ ì–¸ì œë‚˜ í”„ë¡œë¯¸ìŠ¤ë¥¼ ë°˜í™˜í•œë‹¤.

## 45.4 í”„ë¡œë¯¸ìŠ¤ì˜ ì—ëŸ¬ ì²˜ë¦¬

í”„ë¡œë¯¸ìŠ¤ì˜ í›„ì† ì²˜ë¦¬ ë©”ì„œë“œë¥¼ ì´ìš©í•˜ì—¬ ì—ëŸ¬ë¥¼ ì²˜ë¦¬í•  ìˆ˜ ìˆë‹¤. `then` ë©”ì„œë“œ ì´í›„ `catch` ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì•ˆì •ì ì´ë‹¤.

```js
const wrongUrl = "https://jsonplaceholder.typicode.com/XXX/1";

// ë¶€ì ì ˆí•œ URLì´ ì§€ì •ë˜ì—ˆê¸° ë•Œë¬¸ì— ì—ëŸ¬ê°€ ë°œìƒí•œë‹¤.
promiseGet(wrongUrl)
  .then((res) => console.log(res))
  .catch((err) => console.error(err)); // Error: 404
```

## 45.5 í”„ë¡œë¯¸ìŠ¤ ì²´ì´ë‹

í”„ë¡œë¯¸ìŠ¤ì˜ í›„ì† ì²˜ë¦¬ ë©”ì„œë“œë¥¼ ì´ìš©í•´ ì½œë°± í—¬ì„ í•´ê²°í•  ìˆ˜ ìˆë‹¤.

í›„ì† ì²˜ë¦¬ ë©”ì„œë“œì˜ ì½œë°± í•¨ìˆ˜ê°€ í”„ë¡œë¯¸ìŠ¤ê°€ ì•„ë‹Œ ê°’ì„ ë°˜í™˜í•˜ë”ë¼ë„ ê·¸ ê°’ì„ ì•”ë¬µì ìœ¼ë¡œ `resolve` ë˜ëŠ” `reject`í•˜ì—¬ í”„ë¡œë¯¸ìŠ¤ë¥¼ ìƒì„±í•´ ë°˜í™˜í•œë‹¤.

í”„ë¡œë¯¸ìŠ¤ ì²´ì´ë‹ ì—­ì‹œ ì½œë°± íŒ¨í„´ì„ ì‚¬ìš©í•˜ë¯€ë¡œ ì´ëŠ” `async`/`await`ë¥¼ í†µí•´ í•´ê²°í•  ìˆ˜ ìˆë‹¤. `async`/`await`ëŠ” ë§ˆì¹˜ ë™ê¸° ì²˜ë¦¬ì²˜ëŸ¼ í”„ë¡œë¯¸ìŠ¤ê°€ ì²˜ë¦¬ ê²°ê³¼ë¥¼ ë°˜í™˜í•˜ë„ë¡ êµ¬í˜„í•  ìˆ˜ ìˆë‹¤.

```js
const url = "https://jsonplaceholder.typicode.com";

(async () => {
  // idê°€ 1ì¸ postì˜ userIdë¥¼ ì·¨ë“
  const { userId } = await promiseGet(`${url}/posts/1`);

  // ì·¨ë“í•œ postì˜ userIdë¡œ user ì •ë³´ë¥¼ ì·¨ë“
  const userInfo = await promiseGet(`${url}/users/${userId}`);

  console.log(userInfo);
})();
```

## 45.6 í”„ë¡œë¯¸ìŠ¤ì˜ ì •ì  ë©”ì„œë“œ

`Promise`ëŠ” 5ê°€ì§€ ì •ì  ë©”ì„œë“œë¥¼ ì œê³µí•œë‹¤.

### `Promise.resolve` / `Promise.reject`

ì´ ë‘ ê°€ì§€ ë©”ì„œë“œëŠ” ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ê°’ì„ ë˜í•‘í•˜ì—¬ í”„ë¡œë¯¸ìŠ¤ë¥¼ ìƒì„±í•˜ê¸° ìœ„í•´ ì‚¬ìš©í•œë‹¤.

```js
// ë°°ì—´ì„ resolveí•˜ëŠ” í”„ë¡œë¯¸ìŠ¤ë¥¼ ìƒì„±
const resolvedPromise = Promise.resolve([1, 2, 3]);
resolvedPromise.then(console.log); // [1, 2, 3]
```

ë‹¤ìŒ ì˜ˆì œì™€ ë™ì¼í•˜ê²Œ ë™ì‘í•œë‹¤.

```js
const resolvedPromise = new Promise((resolve) => resolve([1, 2, 3]));
resolvedPromise.then(console.log); // [1, 2, 3]
```

### `Promise.all`

ì—¬ëŸ¬ ê°œì˜ ë¹„ë™ê¸° ì²˜ë¦¬ë¥¼ ëª¨ë‘ ë³‘ë ¬ ì²˜ë¦¬í•  ë•Œ ì‚¬ìš©í•œë‹¤.

```js
const requestData1 = () =>
  new Promise((resolve) => setTimeout(() => resolve(1), 3000));
const requestData2 = () =>
  new Promise((resolve) => setTimeout(() => resolve(2), 2000));
const requestData3 = () =>
  new Promise((resolve) => setTimeout(() => resolve(3), 1000));

Promise.all([requestData1(), requestData2(), requestData3()])
  .then(console.log) // [ 1, 2, 3 ] â‡’ ì•½ 3ì´ˆ ì†Œìš”
  .catch(console.error);
```

`Promise.all` ë©”ì„œë“œëŠ” í”„ë¡œë¯¸ìŠ¤ë¥¼ ìš”ì†Œë¡œ ê°–ëŠ” ë°°ì—´ ë“±ì˜ ì´í„°ëŸ¬ë¸”ì„ ì¸ìˆ˜ë¡œ ì „ë‹¬ë°›ëŠ”ë‹¤. ê·¸ë¦¬ê³  ì „ë‹¬ë°›ì€ ëª¨ë“  í”„ë¡œë¯¸ìŠ¤ê°€ ëª¨ë‘ `fulfilled` ìƒíƒœê°€ ë˜ë©´ ëª¨ë“  ì²˜ë¦¬ ê²°ê³¼ë¥¼ ë°°ì—´ì— ì €ì¥í•´ ìƒˆë¡œìš´ í”„ë¡œë¯¸ìŠ¤ë¥¼ ë°˜í™˜í•œë‹¤. í•˜ë‚˜ë¼ë„ `rejected` ìƒíƒœê°€ ë˜ë©´ ë‚˜ë¨¸ì§€ í”„ë¡œë¯¸ìŠ¤ê°€ `fulfilled` ìƒíƒœê°€ ë˜ëŠ” ê²ƒì„ ê¸°ë‹¤ë¦¬ì§€ ì•Šê³  ì¦‰ì‹œ ì¢…ë£Œí•œë‹¤.

ì¢…ë£Œí•˜ëŠ” ë° ê±¸ë¦¬ëŠ” ì‹œê°„ì€ ê°€ì¥ ëŠ¦ê²Œ `fulfilled` ìƒíƒœê°€ ë˜ëŠ” í”„ë¡œë¯¸ìŠ¤ì˜ ì²˜ë¦¬ ì‹œê°„ë³´ë‹¤ ì¡°ê¸ˆ ë” ê¸¸ë‹¤.

ì²˜ë¦¬ ê²°ê³¼ë¥¼ ì°¨ë¡€ëŒ€ë¡œ ë°°ì—´ì— ì €ì¥í•´ ê·¸ ë°°ì—´ì„ `resolve`í•˜ëŠ” ìƒˆë¡œìš´ í”„ë¡œë¯¸ìŠ¤ë¥¼ ë°˜í™˜í•œë‹¤. ì¦‰, ì²˜ë¦¬ ìˆœì„œê°€ ë³´ì¥ëœë‹¤.

ì¸ìˆ˜ë¡œ ì „ë‹¬ë°›ì€ ì´í„°ëŸ¬ë¸”ì˜ ìš”ì†Œê°€ í”„ë¡œë¯¸ìŠ¤ê°€ ì•„ë‹Œ ê²½ìš° `Promise.resolve` ë©”ì„œë“œë¥¼ í†µí•´ í”„ë¡œë¯¸ìŠ¤ë¡œ ë˜í•‘í•œë‹¤.

```js
// GET ìš”ì²­ì„ ìœ„í•œ ë¹„ë™ê¸° í•¨ìˆ˜
const promiseGet = (url) => {
  return new Promise((resolve, reject) => {
    const xhr = new XMLHttpRequest();
    xhr.open("GET", url);
    xhr.send();

    xhr.onload = () => {
      if (xhr.status === 200) {
        // ì„±ê³µì ìœ¼ë¡œ ì‘ë‹µì„ ì „ë‹¬ë°›ìœ¼ë©´ resolve í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•œë‹¤.
        resolve(JSON.parse(xhr.response));
      } else {
        // ì—ëŸ¬ ì²˜ë¦¬ë¥¼ ìœ„í•´ reject í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•œë‹¤.
        reject(new Error(xhr.status));
      }
    };
  });
};

const githubIds = ["jeresig", "ahejlsberg", "ungmo2"];

Promise.all(
  githubIds.map((id) => promiseGet(`https://api.github.com/users/${id}`))
)
  // [Promise, Promise, Promise] => Promise [userInfo, userInfo, userInfo]
  .then((users) => users.map((user) => user.name))
  // [userInfo, userInfo, userInfo] => Promise ['John Resig', 'Anders Hejlsberg', 'Ungmo Lee']
  .then(console.log)
  .catch(console.error);
```

### `Promise.race`

`Promise.all` ë©”ì„œë“œì™€ ë™ì¼í•˜ê²Œ í”„ë¡œë¯¸ìŠ¤ë¥¼ ìš”ì†Œë¡œ ê°–ëŠ” ë°°ì—´ ë“±ì˜ ì´í„°ëŸ¬ë¸”ì„ ì¸ìˆ˜ë¡œ ì „ë‹¬ë°›ëŠ”ë‹¤. ê°€ì¥ ë¨¼ì € `fulfilled` ìƒíƒœê°€ ëœ í”„ë¡œë¯¸ìŠ¤ì˜ ì²˜ë¦¬ ê²°ê³¼ë¥¼ `resolve`í•˜ëŠ” ìƒˆë¡œìš´ í”„ë¡œë¯¸ìŠ¤ë¥¼ ë°˜í™˜í•œë‹¤.

```js
Promise.race([
  new Promise((resolve) => setTimeout(() => resolve(1), 3000)), // 1
  new Promise((resolve) => setTimeout(() => resolve(2), 2000)), // 2
  new Promise((resolve) => setTimeout(() => resolve(3), 1000)), // 3
])
  .then(console.log) // 3
  .catch(console.log);
```

í”„ë¡œë¯¸ìŠ¤ê°€ `rejected` ìƒíƒœê°€ ë˜ë©´ `Promise.all` ë©”ì„œë“œì™€ ë™ì¼í•˜ê²Œ ì²˜ë¦¬ëœë‹¤.

### `Promise.allSettled`

ES11ì— ë„ì…ë˜ì—ˆë‹¤. í”„ë¡œë¯¸ìŠ¤ë¥¼ ìš”ì†Œë¡œ ê°–ëŠ” ë°°ì—´ ë“±ì˜ ì´í„°ëŸ¬ë¸”ì„ ì¸ìˆ˜ë¡œ ì „ë‹¬ë°›ëŠ”ë‹¤. ì „ë‹¬ë°›ì€ í”„ë¡œë¯¸ìŠ¤ê°€ ëª¨ë‘ `settled` ìƒíƒœê°€ ë˜ë©´ ì²˜ë¦¬ ê²°ê³¼ë¥¼ ë°°ì—´ë¡œ ë°˜í™˜í•œë‹¤.

```JS
Promise.allSettled([
  new Promise(resolve => setTimeout(() => resolve(1), 2000)),
  new Promise((_, reject) => setTimeout(() => reject(new Error('Error!')), 1000))
]).then(console.log);
/*
  // í”„ë¡œë¯¸ìŠ¤ê°€ fulfilled ìƒíƒœì¸ ê²½ìš°
  {status: "fulfilled", value: 1},
  // í”„ë¡œë¯¸ìŠ¤ê°€ rejected ìƒíƒœì¸ ê²½ìš°
  {status: "rejected", reason: Error: Error! at <anonymous>:3:60}
]
*/
```

## 45.7 ë§ˆì´í¬ë¡œíƒœìŠ¤í¬ í

ë§ˆì´í¬ë¡œíƒœìŠ¤í¬ íì—ëŠ” í”„ë¡œë¯¸ìŠ¤ì˜ í›„ì† ì²˜ë¦¬ ë©”ì„œë“œì˜ ì½œë°± í•¨ìˆ˜ê°€ ì¼ì‹œ ì €ì¥ëœë‹¤. ê·¸ ì™¸ì˜ ë¹„ë™ê¸° í•¨ìˆ˜ì˜ ì½œë°± í•¨ìˆ˜ë‚˜ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ëŠ” íƒœìŠ¤í¬ íì— ì¼ì‹œ ì €ì¥ëœë‹¤.

ë§ˆì´í¬ë¡œíƒœìŠ¤í¬ íëŠ” íƒœìŠ¤í¬ íë³´ë‹¤ ìš°ì„ ìˆœìœ„ê°€ ë†’ë‹¤. ì¦‰, ì´ë²¤íŠ¸ ë£¨í”„ëŠ” ì½œ ìŠ¤íƒì´ ë¹„ë©´ ë¨¼ì € ë§ˆì´í¬ë¡œíƒœìŠ¤í¬ íì—ì„œ ëŒ€ê¸°í•˜ê³  ìˆëŠ” í•¨ìˆ˜ë¥¼ ê°€ì ¸ì™€ ì‹¤í–‰í•œë‹¤. ì´í›„ ë§ˆì´í¬ë¡œíƒœìŠ¤í¬ íê°€ ë¹„ë©´ íƒœìŠ¤í¬ íì—ì„œ ëŒ€ê¸°í•˜ê³  ìˆëŠ” í•¨ìˆ˜ë¥¼ ê°€ì ¸ì™€ ì‹¤í–‰í•œë‹¤.

## 45.8 `fetch`

HTTP ìš”ì²­ ì „ì†¡ ê¸°ëŠ¥ì„ ì œê³µí•˜ëŠ” í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ Web APIë‹¤. `XMLHttpRequest` ê°ì²´ë³´ë‹¤ ì‚¬ìš©ë²•ì´ ê°„ë‹¨í•˜ê³  í”„ë¡œë¯¸ìŠ¤ë¥¼ ì§€ì›í•´ ë¹„ë™ê¸° ì²˜ë¦¬ë¥¼ ìœ„í•œ ì½œë°± íŒ¨í„´ì˜ ë‹¨ì ì—ì„œ ììœ ë¡­ë‹¤.

`fetch` í•¨ìˆ˜ì—ëŠ” ì¸ìˆ˜ë¡œ HTTP ìš”ì²­ì„ ì „ì†¡í•  URLê³¼ HTTP ìš”ì²­ ë©”ì„œë“œ, HTTP ìš”ì²­ í—¤ë”, í˜ì´ë¡œë“œ ë“±ì„ ì„¤ì •í•œ ê°ì²´ë¥¼ ì „ë‹¬í•œë‹¤. URLë§Œ ì „ë‹¬í•˜ë©´ GET ìš”ì²­ì„ ì „ì†¡í•œë‹¤.

`fetch` í•¨ìˆ˜ëŠ” HTTP ì‘ë‹µì„ ë‚˜íƒ€ë‚´ëŠ” `Response` ê°ì²´ë¥¼ ë˜í•‘í•œ `Promise` ê°ì²´ë¥¼ ë°˜í™˜í•œë‹¤.

`Response` ê°ì²´ëŠ” HTTP ì‘ë‹µì„ ë‚˜íƒ€ë‚´ëŠ” ë‹¤ì–‘í•œ í”„ë¡œí¼í‹°ë¥¼ ì œê³µí•œë‹¤.

`Response.prototype`ì—ëŠ” `Response` ê°ì²´ì— í¬í•¨ë˜ì–´ ìˆëŠ” HTTP ì‘ë‹µ ëª¸ì²´ë¥¼ ìœ„í•œ ë‹¤ì–‘í•œ ë©”ì„œë“œë¥¼ ì œê³µí•œë‹¤. ì˜ˆë¥¼ ë“¤ì–´, í”„ë¡œë¯¸ìŠ¤ê°€ ë˜í•‘í•˜ê³  ìˆëŠ” MIME íƒ€ì…ì´ `application/json`ì¸ HTTP resposne bodyë¥¼ ì·¨ë“í•˜ë ¤ë©´ `Response.prototype.json` ë©”ì„œë“œë¥¼ ì‚¬ìš©í•œë‹¤. ì´ ë©”ì„œë“œëŠ” response bodyë¥¼ ì·¨ë“í•´ ì—­ì§ë ¬í™”í•œë‹¤.

```js
fetch("https://jsonplaceholder.typicode.com/todos/1")
  // responseëŠ” HTTP ì‘ë‹µì„ ë‚˜íƒ€ë‚´ëŠ” Response ê°ì²´ì´ë‹¤.
  // json ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ Response ê°ì²´ì—ì„œ HTTP ì‘ë‹µ ëª¸ì²´ë¥¼ ì·¨ë“í•˜ì—¬ ì—­ì§ë ¬í™”í•œë‹¤.
  .then((response) => response.json())
  // jsonì€ ì—­ì§ë ¬í™”ëœ HTTP ì‘ë‹µ ëª¸ì²´ì´ë‹¤.
  .then((json) => console.log(json));
// {userId: 1, id: 1, title: "delectus aut autem", completed: false}
```

âš ï¸`fetch` í•¨ìˆ˜ê°€ ë°˜í™˜í•˜ëŠ” í”„ë¡œë¯¸ìŠ¤ëŠ” ë¶ˆë¦¬ì–¸ íƒ€ì…ì˜ `ok` ìƒíƒœë¥¼ `false`ë¡œ ì„¤ì •í•œ `Response` ê°ì²´ë¥¼ `resolve`í•œë‹¤. (`404 Not Found`ë‚˜ `500 Internal Server Error`ì™€ ê°™ì€ HTTP ì—ëŸ¬ë¥¼ `reject`í•˜ì§€ ì•ŠëŠ”ë‹¤.) ì˜¤í”„ë¼ì¸ ë“±ì˜ ë„¤íŠ¸ì›Œí¬ ì¥ì• ë‚˜ CORS ì—ëŸ¬ì— ì˜í•´ ìš”ì²­ì´ ì™„ë£Œë˜ì§€ ëª»í•œ ê²½ìš°ì—ë§Œ í”„ë¡œë¯¸ìŠ¤ë¥¼ `reject`í•œë‹¤.

```js
const wrongUrl = "https://jsonplaceholder.typicode.com/XXX/1";

// ë¶€ì ì ˆí•œ URLì´ ì§€ì •ë˜ì—ˆê¸° ë•Œë¬¸ì— 404 Not Found ì—ëŸ¬ê°€ ë°œìƒí•œë‹¤.
fetch(wrongUrl)
  // responseëŠ” HTTP ì‘ë‹µì„ ë‚˜íƒ€ë‚´ëŠ” Response ê°ì²´ë‹¤.
  .then((response) => {
    if (!response.ok) throw new Error(response.statusText);
    return response.json();
  })
  .then((todo) => console.log(todo))
  .catch((err) => console.error(err));
```

ğŸ’¡axiosëŠ” ëª¨ë“  HTTP ì—ëŸ¬ë¥¼ rejectí•˜ëŠ” í”„ë¡œë¯¸ìŠ¤ë¥¼ ë°˜í™˜í•œë‹¤.

ë‹¤ìŒì€ `fetch` í•¨ìˆ˜ë¥¼ ì´ìš©í•´ HTTP ìš”ì²­ì„ ì „ì†¡í•˜ëŠ” ì˜ˆì œë‹¤.

```js
const request = {
  get(url) {
    return fetch(url);
  },
  post(url, payload) {
    return fetch(url, {
      method: "POST",
      headers: { "content-Type": "application/json" },
      body: JSON.stringify(payload),
    });
  },
  patch(url, payload) {
    return fetch(url, {
      method: "PATCH",
      headers: { "content-Type": "application/json" },
      body: JSON.stringify(payload),
    });
  },
  delete(url) {
    return fetch(url, { method: "DELETE" });
  },
};
```
