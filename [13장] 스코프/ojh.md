# 13.1 스코프란?

---

- **스코프 (유효 범위)** 는 자바스크립트를 포함한 모든 프로그래밍 언어의 기본적이고 중요한 개념이다.
- var 변수와 let, const 변수는 스코프가 다르게 동작하니 주의해야 한다.
- 변수는 코드의 가장 바깥 뿐 아니라 함수 몸체 내부나 코드 블록 내에서도 선언할 수 있다.
- 변수는 자신이 선언된 위치에 의해 자신이 유효한 범위가 결정된다. 모든 식별자가 그렇다. → 자신이 선언된 위치에 따라 다른 코드가 식별자 자신을 참조할 수 있는 유효 범위, **즉, 식별자가 유효한 범위를 스코프라고 한다.**

```jsx
var var1 = 1;

if (true) {
  var var2 = 2;
  if (true) var var3 = 3;
}

function foo() {
  var var4 = 4;

  function bar() {
    var var5 = 5;
  }
}

console.log(var1);
console.log(var2);
console.log(var3);
console.log(var4); // reference 에러
console.log(var5); // reference 에러
```

- 자바스크립트는 스코프를 통해 어떤 변수를 참조해야 할 것인지 결정한다. → **식별자 결정**
- **🌟 실행 컨텍스트와 렉시컬 환경 (어차피 뒤에 자세히 나오겠지만)**
  ### **렉시컬 환경(Lexical Environment)이란?**
  > "변수와 함수 선언 정보를 저장하고, 상위 스코프 정보를 가지고 있는 환경"
  >
  > **렉시컬 환경(Lexical Environment)** 은 실행 컨텍스트의 일부로, **변수, 함수 선언 및 상위 스코프 정보(Outer Environment Reference)를 저장하는 역할**을 합니다.
  ✔ **구성 요소**
  1️⃣ **환경 레코드(Environment Record)**
  - 현재 실행 중인 블록 내에서 선언된 **변수, 함수, 매개변수 등을 저장하는 공간**
  - `let`, `const`, `var`, `function` 선언이 포함됨
  2️⃣ **외부 환경 참조(Outer Environment Reference)**
  - 상위 스코프 정보를 참조
  - 이를 통해 **스코프 체인(Scope Chain)을 형성**하여 변수 검색이 가능
  ### **실행 컨텍스트(Execution Context)란?**
  > 자바스크립트 코드가 실행되는 환경을 정의하는 개념
  >
  > 자바스크립트 엔진은 **코드를 실행할 때 "실행 컨텍스트(Execution Context)"라는 개념을 사용하여 실행 환경을 관리**합니다.
  **✅ 실행 컨텍스트의 주요 역할**
  - **코드 실행에 필요한 정보(변수, 함수, `this`, 스코프 등)를 저장하고 관리**
  - **콜 스택(Call Stack)에 쌓였다가 실행이 끝나면 제거됨**
  - **각 실행 컨텍스트는 "렉시컬 환경(Lexical Environment)"을 포함**
- 만약 스코프라는 개념이 없더라면 식별자는 유일해야 한다. → 이 얼마나 불편하겠느냐…
- ❗ var 키워드는 스코프 내에서 중복 선언이 허용된다. → 이를 막기 위해서 나온 것이 ES6 의 let, const 이 둘의 같은 스코프 내에서 중복 선언을 허용하지 않는다.
- ❗또한 var 키워드는 함수 스코프이며, let,const 는 블록 스코프이다.
- var, let, const 의 차이
  | 차이점                                | `var`                   | `let`          | `const`        |
  | ------------------------------------- | ----------------------- | -------------- | -------------- |
  | **스코프(Scope)**                     | 함수 스코프             | 블록 스코프    | 블록 스코프    |
  | **중복 선언**                         | 가능                    | 불가능         | 불가능         |
  | **호이스팅**                          | ✅ (초기값 `undefined`) | ✅ (TDZ 발생)  | ✅ (TDZ 발생)  |
  | **재할당 가능 여부**                  | 가능                    | 가능           | ❌ (불가능)    |
  | **초기화 필수 여부**                  | X (자동 `undefined`)    | X              | ✅ (필수)      |
  | **전역 객체(window/globalThis) 등록** | ✅ (등록됨)             | ❌ (등록 안됨) | ❌ (등록 안됨) |
  ### 간략하게 차이 설명
  - var → 함수 스코프, 호이스팅 되며 undefined 초기화, 전역 객체로 등록됨, 중복 선언 허용
  - let,const → 블록 스코프, 호이스팅은 되나 초기화 되기 이전에 접근 불가, 전역 객체 등록 X , 중복 선언 허용 X

# 13.2 스코프의 종류

---

- 코드는 전역과 지역으로 구분할 수 있다.
- 전역에서 선언된 변수는 전역 스코프 vs 지역에서 선언된 변수는 지역 스코프이다.
- 전역변수는 어디서든지 참조할 수 있다
- 지역변수는 자신의 지역 스코프와 하위 스코프에서 유효하다. (지역이란 함수 몸체 내부!)

# 13.3 스코프 체인

---

- 함수 몸체 내부에서 함수가 정의된 것을 함수의 중첩이라고 한다. 중첩 함수와 외부 함수
- ❗함수의 지역 스코프도 중첩에 의해 **계층적 구조**를 갖는다.
- ❗외부 함수의 지역 스코프를 **상위 스코프**라고 한다.
- 이처럼 스코프가 계층적으로 연결된 것을 **스코프 체인**이라고 한다.
- 🌟 **변수를 참조할 때 자바스크립트 엔진은 스코프 체인을 통해 변수를 참조하는 코드의 스코프에서 시작하여 상위 스코프 방향으로 이동하며 선언된 변수를 검색한다.**
- 스코프 체인은 물리적인 실체로 존재한다. 자바스크립트 엔진은 코드를 실행하기에 앞서 자료구조인 렉시컬 환경을 실제로 생성한다.
- 📌 **렉시컬 환경(Lexical Environment)은 어떤 자료구조인가?**
  **렉시컬 환경(Lexical Environment) = 키-값 형태의 객체**
  렉시컬 환경은 **"변수, 함수, 상위 스코프 정보를 저장하는 자료구조"**예요.
  자바스크립트 엔진은 **실행 컨텍스트를 생성할 때, 이를 위한 "렉시컬 환경"도 함께 생성**합니다.

1. 스코프 체인에 의한 변수 검색
   - 상위 스코프에서 유효한 변수는 하위 스코프에서 자유롭게 참조할 수 있지만, 하위 스코프에서 유효한 변수는 상위 스코프에서 참조할 수 없다.
2. 스코프 체인에 의한 함수 검색
   - 함수도 식별자이기 떄문에 위와 동일하다.

# 13.4 함수 레벨 스코프

---

- 🌟지역은 함수 몸체 내부를 말하고 지역 스코프를 만든다. 즉, 코드 블록이 아닌 함수에 의해서만 지역 스코프가 생성된다는 의미!!
- 대부분의 프로그래밍 언어는 블록이 지역 스코프를 만들고 이를 **블록 레벨 스코프**라고 한다. 하지만 함수는 **함수 레벨 스코프이다.**
- 즉, 아래와 같은 경우 의도치 않게 재할당이 될 수 있다.

```jsx
var x = 1;
if (true) {
  var x = 10;
}
console.log(x); // 10 , 다른 언어 였다면 1 을 기대했을 것이다.

var i = 0;
for (var i = 0; i < 5; i++) console.log(i);
console.log(i); // 5 , 다른 언어 였다면 0 을 기대했을 것이다.
```

- ES6 에서 추가된 let, const 은 블록 레벨 스코프를 지원한다.

# 13.5 렉시컬 스코프 🌟

```jsx
var x = 1;

function foo() {
  var x = 10;
  bar();
}

function bar() {
  console.log(x);
}

foo(); // 1
bar(); // 1
```

- 프로그래밍 언어는 크게 2가지 방법으로 상위 스코프를 결정한다.
  1. **함수를 호출한 위치 → 동적 스코프**
  2. **함수를 정의한 위치 → 정적 스코프 (렉시컬 스코프)**
- ❗ 자바스크립트와 같은 대부분의 프로그래밍 언어는 렉시컬 스코프를 따른다. 즉, 함수의 상위 스코프는 **언제나 자신이 정의된 스코프이다.**
- 그렇기에 bar 내부의 x 는 상위 스코프의 x 가 1 이므로 두 결과 모두 1이다!
- 🌟 이처럼 상위 스코프는 함수 정의가 실행될 때 정적으로 결정된다. 함수 정의가 실행되어 실행된 함수 객체는 이렇게 결정된 상위 스코프를 기억한다. 함수가 호출될 때마다 함수의 상위 스코프를 참조할 필요가 있기 때문이다. ⇒ 렉시컬 스코프는 클로저와 깊은 관련이 있다.
