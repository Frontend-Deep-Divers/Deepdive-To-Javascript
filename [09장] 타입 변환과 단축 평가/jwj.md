# 9장 타입 변화과 단축 평가

## 9.1 타입 변환이란?

- 명시적 타입 변환(타입 캐스팅): 개발자가 의도적으로 값의 타입을 변환하는 것
- 암묵적 타입 변환(타입 강제 변환): 자바스크립트 엔진에 의해 암묵적으로 타입이 자동 변환되는 것

타입 변환 시 기존 원시 값이 직접 변경되는 것은 아니다. 원시 값은 **변경 불가능한 값**이므로 변경할 수 없다.

타입 변환은 기존 원시 값을 사용해 다른 타입의 원시 값을 생성하는 것이다.

⚠자바스크립트의 암묵적 타입 변환은 개발자의 의도와 다른 동작을 불러올 수 있다.

1. 자신이 작성한 코드에서 암묵적 타입 변환이 발생하는지,
2. 발생한다면 어떤 타입으로 변환되는지,
3. 타입 변환된 값으로 표현식이 어떻게 평가될 것인지 예측 가능해야 한다.

나와 동료가 작성한 코드가 서로에게 쉽게 이해 가능해야 한다. 이를 위해 타입 변환이 어떻게 작동하는지 이해하고 있어야 한다.

## 9.2 암묵적 타입 변환

암묵적 타입 변환이 발생하면 문자열, 숫자, 불리언 같은 원싵 타입 중 하나로 타입을 자동 변환한다.

암묵적 타입 변환은 데이터 타입에 따라 상이하게 동작하므로 모든 경우의 수를 다 알고 있을 필요는 없지만, 동작 결과를 어느 정도 예상할 수 있는 정도면 충분할 것 같다.

### 문자열 타입으로 변환

**대체로 `+` 연산자는 피연산자 중 하나 이상이 문자열이면 문자열 연결 연산자로 작동하여 문자열로 변환시킨다.**

### 숫자 타입으로 변환

`+`를 제외한 다른 산술 연산자는 피연산자를 자동 타입 변환해 숫자 타입으로 변환해 평가한다.

비교 연산자 역시 피연산자를 비교할 때 숫자가 아닌 타입의 값을 숫자 타입으로 강제 변환해 평가한다.

`+` 단항 연산자를 붙이면 피연산자를 숫자 타입으로 타입 변환한다.

```java
+'' // 0
+'0' // 0
+'1' // 1
+'string' // NaN

+true // 1
+false // 0

+null // 0

+{} // NaN
+[] // 0
```

⚠**빈 문자열, 빈 배열, null, false는 0으로, true는 1로 변환된다. 객체와 빈 배열이 아닌 배열, undefined는 변환되지 않아 NaN이 된다.**

### 불리언 타입으로 변환

자바스크립트 엔진은 `if` 문이나 `for` 문의 조건식의 평가 결과를 불리언 타입으로 암묵적 타입 변환한다.

이떄 불리언 타입이 아닌 경우, Truthy(참으로 평가되는 값) 값이나 Falsy 값(거짓으로 평가되는 값)으로 구분한다.

```js
if ("") console.log("1");
if (true) console.log("2");
if (0) console.log("3");
if ("str") console.log("4");
if (null) console.log("5");

// 2 4
```

Falsy 값들은 다음과 같다.

- `false`
- `undefined`
- `null`
- `0`, `-0`
- `NaN`
- `''` (빈 문자열)

이외의 값들은 모두 Truthy 값이다.

## 9.3 명시적 타입 변환

명시적으로 타입을 변경하는 방법은 다음과 같다.

1. 표준 빌트인 생성자 함수(`String`, `Number`, `Boolean`)를 new 연산자 없이 호출한다.
2. `new` 키워드와 빌트인 메서드를 사용한다.
3. 의도적으로 암묵적 타입 변환을 사용한다.

### 문자열 타입으로 변환

다음과 같은 방법이 있다.

1. `String` 생성자 함수를 `new` 연산자 없이 호출
2. `Object.prototype.toString` 메서드를 사용
3. 문자열 연결 연산자를 이용

```js
// 1번
String(1); // '1'

// 2번
(1).toString(); // '1'

// 3번
1 + ""; // '1'
```

### 숫자 타입으로 변환

다음과 같은 방법이 있다.

1. `Number` 생성자 함수를 `new` 연산자 없이 호출
2. `parseInt`, `parseFloat` 함수를 사용(문자열만 변환 가능)
3. `+` 단항 산술 연산자를 이용
4. `*` 산술 연산자를 이용

```js
// 1번
Number("0"); // 0

// 2번
parseInt("0"); // 0

// 3번
+"0"; // 0

// 4번
"0" * 1; // 0
```

### 불리언 타입으로 변환

1. `Boolean` 생성자 함수를 `new` 연산자 없이 호출
2. `!` 부정 논리 연산자를 두 번 사용

💡부정 논리 연산자는 몇 번이고 연속해서 사용할 수 있다.

```js
// 1번
Boolean("x"); // true

// 2번
!!"x"; // true
!!0; // false
```

## 9.4 단축 평가

### 9.4.1 논리 연산자를 사용한 단축 평가

논리합(`||`)과 논리곱(`&&`)의 연산자 표현식의 평가 결과는 불리언 값이 아닐 수도 있다.

논리합 또는 논리곱 연산자 표현식은 언제나 2개의 피연산자 중 어느 한쪽으로 평가된다.

```js
"Cat" && "Dog"; // "Dog"
```

논리곱 연산자는 두 개의 피연산자가 모두 `true`로 평가될 때 `true`를 반환한다. 그리고 좌항에서 우항으로 평가된다.

위 코드에서 `"Cat"`은 `true`로 평가된다. `"Dog"` 역시 `true`기 때문에, 두 번째 피연산자가 위 논리곱 연산자 표현식의 결과를 결정하며, 이때 그대로 두 번째 피연산자를 반환하게 된다.

논리합 연산자도 동일하게 동작한다.

```js
"Cat" || "Dog"; // "Cat"
```

`"Cat"`은 이미 `true`이므로 두 번째 피연산자를 확인해보지 않아도 논리합 연산자 표현식은 `true` 값으로 평가된다. 때문에 그래도 첫 번째 피연산자를 반환하게 된다.

이처럼 논리곱 연산자와 논리합 연산자는 **피연산자를 타입 변환하지 않고 그대로 반환하는데, 이를 단축 평가(short-circuit evaluation)라 한다**.

단축 평가는 표현식을 평가하는 도중에 결과가 확정된 경우 나머지 평과 과정을 생략하는 것을 말한다.

```js
var done = true;

if (done) message = "완료";
message = done && "완료"; // if 문을 단축 평가로 대체

if (!done) message = "미완료";
message = done || "미완료"; // if 문을 단축 평가로 대체
```

단축 평가는 다음과 같은 두 상황에서 유용하게 쓰인다.

1. 객체를 가리키기를 기대하는 변수가 `null` 또는 `undefined`가 아닌지 확인하고 프로퍼티를 참조할 때

   ```js
   var elem = null;
   var value = elem.value; // TypeError: Cannot read property 'value' of null

   var = elem && elem.value; // null
   ```

2. 함수 매개변수에 기본값을 설정할 때 (ES6 문법으로 대체 가능)

   ```js
   function getStringLength(str) {
     str = str || "";
     return str.length;
   }
   // ES6 문법
   function getStringLength(str = "") {
     return str.length;
   }
   ```

### 9.4.2 옵셔널 체이닝 연산자

ES11(ES2020)에서 도입되었다.

이전에는 `&&`를 사용한 단축 평가를 자주 사용했다.

**`?.`는 좌항의 피연산자가 `null` 또는 `undefined`인 경우, `undefined`를 반환하고, 그렇지 않으면 우항의 프로퍼티 참조를 이어간다.**

```js
var elem = null;
var = elem?.value; // undefined
```

`elem`이 `null` 또는 `undefined`인지 확인하고 프로퍼티를 참조할 때 유용하다.

💡`&&` 단축 평가와 다르게 좌항의 피연산자가 Falsy 값이라도 그대로 반환한다.

### 9.4.3 null 병합 연산자

ES11(ES2020)에서 도입되었다.

**`??`는 좌항의 피연산자가 `null` 또는 `undefined`인 경우 우항의 피연산자를 반환하고, 그렇지 않으면 좌항의 피연산자를 반환한다.**

```js
var foo = null ?? "default value";
```

`foo`에 기본값을 설정할 때 유용하다.

💡`||` 단축 평가와 다르게 좌항의 피연산자가 Falsy 값이라도 `null`이나 `undefined`가 아니면 그대로 반환한다.
